import { Canvas, Meta, Story } from "@storybook/addon-docs";

<Meta title="Storage Plugin Docs/How It Works" />


# How it works

##

<br/>

* ## Working
  
  <br/>
  
  * Storage plugin instance will be running with a **Dapr Sidecar** which
  is managed by our **Engine** plugin.
  
  
  <br/>
  
  
  
  * Our storage plugin instance is written in **Express App** which is connected
  with our **Glue Graphql plugin** and we have already configured the configuration
  for **Minio Plugin instance** in order to store the files which is running behind the scene.
  
  
  <br/>
  
  * Behind the scene what is happening is, we have created an **Express.js** application
  inside which we have connected it with **minio** and **graphql**. We have created routes
  specially for uploading the file and getting the details of already uploaded file.
  
  <br/>
  
  * If the storage plugin is installed correctly, then we will get a folder named storage
  inside our functions folder, where our whole logic of file upload and saving its information
  to graphql is written.

  <br/>
  
  * Our directory stucture for the **storage plugin instance** will be something
    like this:
    <br/>

    ```
      ðŸ“¦storage
        â”£ ðŸ“‚dist
        â”£ ðŸ“‚node_modules
        â”£ ðŸ“‚src
        â”ƒ â”£ ðŸ“‚controllers
        â”ƒ â”ƒ â”£ ðŸ“‚storage
        â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚graphql
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œmutations.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œqueries.ts
        â”ƒ â”ƒ â”ƒ â”£ ðŸ“‚handlers
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œfile.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œget.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”£ ðŸ“œindex.ts
        â”ƒ â”ƒ â”ƒ â”ƒ â”— ðŸ“œupload.ts
        â”ƒ â”ƒ â”ƒ â”— ðŸ“œhelpers.ts
        â”ƒ â”ƒ â”— ðŸ“œcommons.ts
        â”ƒ â”£ ðŸ“‚middlewares
        â”ƒ â”ƒ â”— ðŸ“œ.gitkeep
        â”ƒ â”£ ðŸ“‚providers
        â”ƒ â”ƒ â”£ ðŸ“œexpress.ts
        â”ƒ â”ƒ â”£ ðŸ“œlocals.ts
        â”ƒ â”ƒ â”— ðŸ“œroutes.ts
        â”ƒ â”£ ðŸ“‚routes
        â”ƒ â”ƒ â”£ ðŸ“œ.gitkeep
        â”ƒ â”ƒ â”— ðŸ“œstorage.ts
        â”ƒ â”— ðŸ“œindex.ts
        â”£ ðŸ“œ.env
        â”£ ðŸ“œDockerfile
        â”£ ðŸ“œREADME.md
        â”£ ðŸ“œpackage.json
        â”£ ðŸ“œrouter.js
        â”— ðŸ“œtsconfig.json
    ```
  <br/>
  <br/>
  
  * In order to interact with this plugin there is a file named routes.js
    present in root directory of the instance. If we open that **routes.js** 
    file, we will see a string value attached to a key named **path**, this
    is the string which we need to append after our nginx url(http://localhost:9090).
  
    In our case our path value will be something like this:
    
    ```
        module.exports = () => [
        {
          "path": "/backend/storage/upload",
          "size_in_mb": 100,
          "proxy": {
            "instance": "storage:3500",
            "path": "/v1.0/invoke/storage/method/upload",
          },
        },
       ];
    ```
    
    <br/>
  
    So in order to access our **storage plugin instance** its base url will be
    something like this,
    
    
    **http://localhost:9090/backend/storage/upload/**
  
  <br/>
  <br/>
  
  * In order to start this plugin we need to run the following command:
    
    <br/>
  
    ```bash
      $ node glue develop:up
    ```
  
    <br/>

    This command will start running the docker image of all the instances
    and plugin we have created. Here, in this case it will start running
    our **storage plugin instance image**, inside our **engine** container.
  
  <br/>

* ## Instructions to start development of auth plugin instance
  
  <br/>
  
  * Inside our **storage instance directory** we will see that there is
  directory named **src** in which we have **express** app wirtten in 
  **typescript**. We can go ahead and start our development from there.













